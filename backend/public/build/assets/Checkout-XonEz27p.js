import{_ as ve,u as fe,E as he,I as _e,r as $,h as ye,i as be,c as d,a as e,t as o,G as B,n as ae,d as g,w as ge,b as we,v as ke,e as v,F as xe,A as $e,H as Ce,s as E,x as M,y as Te,z as I,f as Pe,S as c,o as p}from"./app-BOhBFs9K.js";/* empty css            */const Be={class:"bg-light py-5"},De={class:"container"},je={class:"checkout-wizard bg-white theme-shadow my-4"},Ae={class:"fw-bold px-5 py-4 border-bottom mb-0"},Oe={class:"row"},Ie={class:"border rounded-3 p-2 p-lg-4 mb-4"},ze={class:"row"},Ee={class:"col-12 col-lg-4"},Me=["src"],Se={class:"col-12 col-lg-8"},We={class:"mt-4 mt-lg-0"},Ne={class:"d-flex mt-3 pb-3"},Re=["src"],Ve={class:"d-block"},He={class:"text-muted ms-2"},Fe={class:"text-muted"},qe={class:"border rounded-3 p-2 p-lg-4"},Ue={class:"mb-4"},Ge={class:"bg-light rounded-3 p-4"},Le={class:"price-breakdown mb-3"},Je={key:0,class:"d-flex justify-content-between mb-4"},Ke={key:1,class:"d-flex justify-content-between mb-4"},Qe={class:"d-flex justify-content-between mb-4 text-danger"},Xe={class:"mb-3"},Ye={type:"submit",class:"btn btn-primary"},Ze={key:3,class:"d-flex justify-content-between mb-3"},et={class:"me-3"},tt={class:"d-flex justify-content-between flex-wrap"},st={class:"fw-bold me-1"},ot={class:"fw-bold"},nt={key:0,class:"my-3 d-flex justify-content-center"},at={key:0,class:"col-12 col-lg-4 ps-0 d-flex flex-column"},lt={class:"p-2 pe-2 pe-lg-5"},rt={class:"d-flex justify-content-between align-items-center mb-4"},it={class:"fw-bold"},ct={class:"bg-lightgreen text-success rounded px-2 py-1 text-center"},ut=["onClick"],dt=["src"],pt=["checked"],mt={class:"border-top p-4 d-flex align-items-start gap-3"},vt={class:"form-check-label",for:"exampleCheck1"},ft={key:0,class:"mt-auto border-top p-4"},ht={key:1,class:"mt-auto border-top p-4"},_t={disabled:"",class:"btn btn-primary rounded-pill fw-bold w-100"},yt={__name:"Checkout",setup(bt){const l=fe(),D=he(),le=_e(),re=Pe(),j=le.params.id,w=$("stripe"),n=$({}),y=$(0),u=$(0),A=$(!1),C=$(""),O=$(!1);let T=$(!1);ye(()=>y.value,()=>{n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value});const ie=async()=>{try{const s=await I.get("/coupon/validate",{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`},params:{coupon_code:C.value}});y.value=s.data.data.discount,O.value=!0,c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=c.stopTimer,i.onmouseleave=c.resumeTimer}}).fire({icon:"success",title:"Coupon applied successfully"})}catch{c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=c.stopTimer,i.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Coupon code is invalid"})}},ce=async()=>{try{const s=await I.get(`/course/show/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`}});n.value=s.data.data.course,n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value}catch(s){console.error("Error fetching course data:",s)}},ue=()=>{T.value&&w.value?de():c.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=c.stopTimer,t.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Please select a payment method and agree to the terms and conditions"})},de=async()=>{var s,t,i,m,f,h;if(n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value,w.value=="stripe"||w.value=="paypal"||w.value=="razorpay"){if(((s=l==null?void 0:l.masterData)==null?void 0:s.currency)!="USD"&&u.value<((t=l==null?void 0:l.masterData)==null?void 0:t.minimum_amount)){c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=c.stopTimer,a.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:`Please note that a minimum of grand total of ${(i=l==null?void 0:l.masterData)==null?void 0:i.minimum_amount} is required for transaction.`});return}if(((m=l==null?void 0:l.masterData)==null?void 0:m.currency)=="BDT"){c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=c.stopTimer,a.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"BDT is not supported at the moment"});return}}try{const r=await I.get(`/enroll/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`},params:{payment_gateway:w.value,coupon_code:C.value,total_amount:u.value}});me(r.data.data.payment_webview_url)}catch(r){c.fire({icon:"error",title:"Oops...",text:((h=(f=r.response)==null?void 0:f.data)==null?void 0:h.message)||"Something went wrong. Please try again."})}},pe=async()=>{var s,t,i,m,f,h;try{const r=await I.get(`/free/enroll/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`}});if(((t=(s=r==null?void 0:r.data)==null?void 0:s.data)==null?void 0:t.status)=="success"){let a=(m=(i=r==null?void 0:r.data)==null?void 0:i.data)==null?void 0:m.status;re.push(`/enroll_status?status=${a}&course_id=${j}`)}}catch(r){c.fire({icon:"error",title:"Oops...",text:((h=(f=r.response)==null?void 0:f.data)==null?void 0:h.message)||"Something went wrong. Please try again."})}};be(async()=>{await ce(),localStorage.removeItem("handle_course_id")});const me=(s,t=!1)=>{t&&console.log(`Opening payment window: ${s}`);const i=700,m=700,f=screen.width/2-i/2,h=screen.height/2-m/2,r=`resizable,height=${m},width=${i},top=${h},left=${f}`,a=window.open(s,"_blank",r);if(!a){t&&console.error("Failed to open payment window");return}a.document.title="Payment Window Screen - Make Payment";let b=null;const k=x=>{t&&console.log(`Closing with status: ${x}`),a&&!a.closed&&a.close(),window.location.pathname!=="/plan_enroll_status"&&(window.location.href=`/plan_enroll_status?status=${x}`)};b=setInterval(()=>{try{if(a.closed){t&&console.log("Window manually closed"),clearInterval(b),k("closed");return}const x=location.host;if(a.location.host===x){const P=a.location.pathname;P.includes("payment/success")?(clearInterval(b),k("success")):P.includes("payment/cancel")?(clearInterval(b),k("cancel")):(P.includes("payment/fail"),clearInterval(b),k("fail"))}}catch{t&&console.warn("Cross-origin access blocked; cannot track status until redirect returns to same-origin.")}},10),a.focus()};return(s,t)=>{var m,f,h,r,a,b,k,z,x,P,S,W,N,R,V,H,F,q,U,G,L,J,K,Q,X,Y,Z,ee,te,se,oe,ne;const i=Te("router-link");return p(),d("section",Be,[e("section",De,[e("section",je,[e("h3",Ae,o(s.$t("Checkout")),1),e("div",Oe,[e("div",{class:ae((m=n.value)!=null&&m.is_free?"col-12":"col-12 col-lg-8 border-end p-4 ps-4 ps-lg-5")},[e("div",Ie,[e("div",ze,[e("div",Ee,[e("img",{src:(f=n.value)==null?void 0:f.thumbnail,width:"100%",alt:"",height:"140px",class:"object-fit-cover rounded-3"},null,8,Me)]),e("div",Se,[e("h5",We,o((h=n.value)==null?void 0:h.title),1),e("div",Ne,[e("img",{src:(a=(r=n.value)==null?void 0:r.instructor)==null?void 0:a.profile_picture,class:"rounded-circle object-fit-cover me-3",height:"30px",width:"30px"},null,8,Re),e("div",null,[e("span",Ve,o((k=(b=n.value)==null?void 0:b.instructor)==null?void 0:k.name),1)])]),e("div",null,[t[4]||(t[4]=e("i",{class:"bi bi-star-fill text-warning me-2"},null,-1)),e("strong",null,o((z=n.value)==null?void 0:z.average_rating),1),e("span",He,"("+o((x=n.value)==null?void 0:x.review_count)+" "+o(s.$t("Reviews"))+")",1),t[5]||(t[5]=e("span",{class:"text-muted mx-1"},[e("i",{class:"bi bi-dot"})],-1)),e("span",Fe,o((P=n.value)==null?void 0:P.student_count)+" "+o(s.$t("Enrolled")),1)])])])]),e("div",qe,[e("h5",Ue,o(s.$t("Order Details")),1),e("div",Ge,[e("div",Le,[(S=n.value)!=null&&S.price?(p(),d("div",Je,[e("span",null,o(s.$t("Course Price")),1),e("strong",null,o((N=(W=g(l))==null?void 0:W.masterData)==null?void 0:N.currency_symbol)+o((R=n.value)!=null&&R.is_free?0:(V=n.value)==null?void 0:V.price),1)])):(p(),d("div",Ke,[e("span",null,o(s.$t("Course Price")),1),e("strong",null,o((F=(H=g(l))==null?void 0:H.masterData)==null?void 0:F.currency_symbol)+o((q=n.value)!=null&&q.is_free?0:(U=n.value)==null?void 0:U.regular_price),1)])),e("div",Qe,[e("span",null,o(s.$t("Discount")),1),e("strong",null,"-"+o((L=(G=g(l))==null?void 0:G.masterData)==null?void 0:L.currency_symbol)+o(y.value),1)]),e("div",Xe,[A.value?B("",!0):(p(),d("span",{key:0,onClick:t[0]||(t[0]=_=>A.value=!0),class:"text-primary text-decoration-underline cursor-pointer"},o(s.$t("Have any coupon"))+"?",1))]),!O.value&&A.value?(p(),d("form",{key:2,onSubmit:ge(ie,["prevent"]),class:"bg-white d-flex rounded-3 p-4 mb-3"},[we(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=_=>C.value=_),class:"form-control me-3",placeholder:"Enter coupon code"},null,512),[[ke,C.value]]),e("button",Ye,o(s.$t("Apply")),1)],32)):B("",!0),O.value?(p(),d("div",Ze,[e("div",null,[t[7]||(t[7]=e("i",{class:"ri-checkbox-circle-fill text-success me-1"},null,-1)),e("span",et,o(s.$t("Coupon Applied")),1),e("small",{onClick:t[2]||(t[2]=_=>{O.value=!1,A.value=!0,C.value=null}),class:"text-success bg-lightgreen px-2 py-1 rounded cursor-pointer"},[v(o(C.value)+" ",1),t[6]||(t[6]=e("i",{class:"ri-edit-line"},null,-1))])])])):B("",!0)]),e("div",tt,[e("span",null,[e("span",st,o(s.$t("Subtotal")),1),e("span",null,"("+o(s.$t("Payable"))+")",1)]),e("span",ot,o((K=(J=g(l))==null?void 0:J.masterData)==null?void 0:K.currency_symbol)+o(u.value),1)])])]),(Q=n.value)!=null&&Q.is_free?(p(),d("div",nt,[e("button",{onClick:pe,class:"d-flex justify-content-center gap-2 btn btn-primary rounded-pill fw-bold w-50"},t[8]||(t[8]=[v(" Enroll Now ",-1),e("i",{class:"bi bi-arrow-right float-end"},null,-1)]))])):B("",!0)],2),(X=n.value)!=null&&X.is_free?B("",!0):(p(),d("div",at,[e("div",lt,[e("div",rt,[e("h5",it,o(s.$t("Payment Method")),1),e("small",ct,[t[9]||(t[9]=e("i",{class:"ri-shield-check-fill me-1"},null,-1)),v(" "+o(s.$t("100% Secure Payment")),1)])]),(p(!0),d(xe,null,$e((Z=(Y=g(l))==null?void 0:Y.masterData)==null?void 0:Z.payment_methods,_=>(p(),d("div",{key:_.id},[e("div",{onClick:gt=>w.value=_.gateway,class:ae("border d-flex justify-content-between align-items-center px-3 mb-3 rounded payment-method mx-auto"+(w.value==_.gateway?" selected":""))},[e("img",{src:_.logo,class:"col-3 py-3"},null,8,dt),e("input",{class:"form-check-input",type:"radio",checked:w.value==_.gateway},null,8,pt)],10,ut)]))),128))]),e("div",mt,[e("input",{type:"checkbox",class:"form-check-input",id:"exampleCheck1",required:"",onChange:t[3]||(t[3]=_=>Ce(T)?T.value=!g(T):T=!g(T))},null,32),e("label",vt,[v(o(s.$t("By proceeding, you agree to the"))+" ",1),E(i,{to:"/page/terms_and_conditions",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:M(()=>[v(o(s.$t("Terms & Condition")),1)]),_:1}),t[10]||(t[10]=v(",",-1)),E(i,{to:"/page/privacy_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:M(()=>[v(o(s.$t("Privacy Policy")),1)]),_:1}),v(" "+o(s.$t("and"))+" ",1),E(i,{to:"/page/refund_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:M(()=>[v(o(s.$t("Refund Policy")),1)]),_:1}),v(" of "+o((te=(ee=g(l))==null?void 0:ee.masterData)==null?void 0:te.name),1)])]),(se=n.value)!=null&&se.is_enrolled?(p(),d("div",ht,[e("button",_t,o(s.$t("Already Enrolled")),1)])):(p(),d("div",ft,[e("button",{onClick:ue,class:"btn btn-primary rounded-pill fw-bold w-100"},[v(o(s.$t("Pay"))+" "+o((ne=(oe=g(l))==null?void 0:oe.masterData)==null?void 0:ne.currency_symbol)+o(u.value)+" ",1),t[11]||(t[11]=e("i",{class:"bi bi-arrow-right float-end"},null,-1))])]))]))])])])])}}},xt=ve(yt,[["__scopeId","data-v-705eb374"]]);export{xt as default};
